import"../chunks/Bg9kRutz.js";import"../chunks/69_IOA4Y.js";import{w as Pt,ag as xt,p as He,aS as Fe,aT as et,s as d,g as e,d as i,t as oe,a as Ue,aU as k,c as s,n as P,r as a,f as H,aV as _e,N as De,$ as It}from"../chunks/DUB8bsv0.js";import{b as U,a as n,t as p,c as Xe,h as kt}from"../chunks/DzHOuBan.js";import{i as Ve}from"../chunks/B06qfcxv.js";import{i as j,s as Ge,a as Je}from"../chunks/DOmRzZIo.js";import{R as At}from"../chunks/B_rXABv2.js";import{s as B}from"../chunks/3nqkJHLA.js";import{f as tt,d as yt}from"../chunks/DbFrp4aS.js";import{p as bt}from"../chunks/Bfc47y5P.js";import{B as ue}from"../chunks/CJvYq0KN.js";import{I as $e}from"../chunks/CJXCr1W0.js";import{L as ve}from"../chunks/DSP103xp.js";import{S as rt}from"../chunks/CJEhnKgE.js";import{z as ce}from"../chunks/K85sQPP8.js";import{_ as ge}from"../chunks/c3aSOx29.js";import{o as Ke}from"../chunks/CHqt2rTE.js";import{t as m}from"../chunks/CF63kifO.js";import{e as Ye,i as Ze}from"../chunks/DJVbMBk7.js";import{I as se}from"../chunks/CHPYNWro.js";import{T as Nt,a as Le}from"../chunks/B_RvuQCl.js";import{T as We}from"../chunks/CBD-qeiU.js";ce.object({mode:ce.enum(["flat","negotiate","discount","mrp"]),data:ce.object({_id:ce.string().optional(),percentage:ce.number().optional(),minPrd:ce.number().optional(),noOfAttempts:ce.number().optional(),items:ce.array(ce.object({productId:ce.string(),discount:ce.number().optional(),mrpReduction:ce.number().optional()})).optional(),isActive:ce.boolean().optional()}).optional()});const fe=Pt({mode:"flat",data:{}});function St(g,A){var v,C;if(!g)return{};switch(A){case"flat":return{_id:g._id,percentage:g.percentage,minPrd:g.minPrd,isActive:g.isActive!==void 0?g.isActive:!0};case"negotiate":return{_id:g._id,percentage:g.percentage,noOfAttempts:g.noOfAttempts,isActive:g.isActive!==void 0?g.isActive:!0};case"discount":return{_id:g._id,items:((v=g.items)==null?void 0:v.map(u=>({productId:u.productId,discount:u.discount})))||[],isActive:g.isActive!==void 0?g.isActive:!0};case"mrp":return{_id:g._id,items:((C=g.items)==null?void 0:C.map(u=>({productId:u.productId,mrpReduction:u.mrpReduction})))||[],isActive:g.isActive!==void 0?g.isActive:!0};default:return{}}}async function wt(){var g;try{const A=xt(fe).mode,v=await ge.get(`/offer/?type=${A}`);if(v.data&&v.data.status)if(v.data.data&&v.data.data.length>0){const C=v.data.data[0],u=St(C,A);return fe.update(N=>({...N,data:u})),u}else return fe.update(C=>({...C,data:{}})),null;else return console.error("Failed to fetch offers:",(g=v.data)==null?void 0:g.message),null}catch(A){return console.error("Error fetching offers:",A),null}}async function $t(g){return fe.update(A=>({...A,mode:g})),wt()}async function at(){const g=xt(fe),{mode:A,data:v}=g;if(!v)return console.error("No data found in the store"),null;try{let C,u;switch(v._id?C=`/offer/update/${v._id}`:C="/offer/create",A){case"flat":if(!v.percentage||!v.minPrd)return console.error("Missing required fields for flat offer"),null;u={type:A,percentage:v.percentage,minPrd:v.minPrd,isActive:v.isActive!==void 0?v.isActive:!0};break;case"negotiate":if(!v.percentage||!v.noOfAttempts)return console.error("Missing required fields for negotiate offer"),null;u={type:A,percentage:v.percentage,noOfAttempts:v.noOfAttempts,isActive:v.isActive!==void 0?v.isActive:!0};break;case"discount":case"mrp":if(!v.items||v.items.length===0)return console.error("No items found for discount/mrp offer"),null;u={type:A,items:v.items,isActive:v.isActive!==void 0?v.isActive:!0};break;default:return console.error("Invalid offer mode"),null}const N=v._id?await ge.patch(C,u):await ge.post(C,u);return N.data&&N.data.status&&N.data.data&&fe.update($=>({...$,data:{...$.data,_id:N.data.data._id}})),N.data}catch(C){return console.error("Error saving offer data:",C),null}}function xe(g,A){fe.update(v=>({...v,data:{...v.data,[g]:A}}))}async function he(){await wt()}var Rt=p('<span class="text-xs text-red-500">Discount must be a valid number</span>'),Dt=p('<span class="text-xs text-red-500">Minimum quantity must be a valid number</span>'),Ft=p('<div class="max-w-[50%] text-maintext mt-10 pl-[10%]"><form class="grid gap-4 py-4"><div><!> <!> <!></div> <div><!> <!> <!></div> <div class="flex items-center space-x-2"><!> <!></div> <!></form></div>');function Ot(g,A){He(A,!1);const[v,C]=Ge(),u=()=>Je(fe,"$offerStore",v);let N=k(!1),$=k(""),x=k(""),F=k(!0);Ke(()=>{he()});function l(c){return/^[0-9]+$/.test(c)}async function Y(){if(!l(e($))){m.error("Discount must be a valid number");return}if(!l(e(x))){m.error("Minimum product quantity must be a valid number");return}xe("percentage",parseInt(e($))),xe("minPrd",parseInt(e(x))),xe("isActive",e(F)),i(N,!0);try{const c=await at();c&&c.status?m.success("Flat offer saved successfully"):m.error("Failed to save flat offer")}catch(c){console.error("Error saving flat offer:",c),m.error("An error occurred while saving")}finally{i(N,!1)}}Fe(()=>u(),()=>{var c,T;u().data&&(i($,((c=u().data.percentage)==null?void 0:c.toString())||""),i(x,((T=u().data.minPrd)==null?void 0:T.toString())||""),i(F,u().data.isActive!==void 0?u().data.isActive:!0))}),et(),Ve();var J=Ft(),W=s(J),K=s(W),M=s(K);ve(M,{for:"discount",children:(c,T)=>{P();var V=U("Discount (%)");n(c,V)},$$slots:{default:!0}});var O=d(M,2);$e(O,{id:"discount",class:"pr-10 mt-1",placeholder:"Ex: 10",get value(){return e($)},set value(c){i($,c)},$$legacy:!0});var w=d(O,2);{var ae=c=>{var T=Rt();n(c,T)};j(w,c=>{e($)&&!l(e($))&&c(ae)})}a(K);var Z=d(K,2),le=s(Z);ve(le,{for:"minQty",children:(c,T)=>{P();var V=U("Minimum Product Quantity");n(c,V)},$$slots:{default:!0}});var pe=d(le,2);$e(pe,{id:"minQty",class:"pr-10 mt-1",placeholder:"Ex: 5",get value(){return e(x)},set value(c){i(x,c)},$$legacy:!0});var ee=d(pe,2);{var me=c=>{var T=Dt();n(c,T)};j(ee,c=>{e(x)&&!l(e(x))&&c(me)})}a(Z);var z=d(Z,2),X=s(z);rt(X,{id:"active-status",get checked(){return e(F)},onCheckedChange:c=>i(F,c)});var be=d(X,2);ve(be,{for:"active-status",children:(c,T)=>{P();var V=U("Active");n(c,V)},$$slots:{default:!0}}),a(z);var ye=d(z,2);ue(ye,{class:"w-[100px]",type:"submit",get disabled(){return e(N)},children:(c,T)=>{P();var V=U();oe(()=>B(V,e(N)?"Saving...":"Save")),n(c,V)},$$slots:{default:!0}}),a(W),a(J),tt("submit",W,bt(Y)),n(g,J),Ue(),C()}var Mt=p('<div class="p-2 text-gray-500">Searching...</div>'),Tt=(g,A,v)=>A({_id:e(v)._id,productName:e(v).productName,price:e(v).price,strikePrice:e(v).strikePrice}),Et=p('<div class="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer flex justify-between items-center"><span class="text-black dark:text-white"> </span> <span class="text-black dark:text-white"> </span></div>'),jt=p('<div class="p-2 text-gray-500">Loading more...</div>'),Ct=p("<!> <!>",1),zt=p('<div class="p-2 text-gray-500">No products found</div>'),qt=p('<div class="dropdown-container absolute z-20 w-full bg-white dark:bg-gray-900 mt-1 border border-gray-200 dark:border-gray-700 rounded shadow-lg max-h-48 overflow-y-auto"><!></div>'),Qt=p('<div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md mb-4"><div class="text-sm text-gray-500 dark:text-gray-400">Preview</div> <div class="flex justify-between items-center mt-1"><div><div class="font-medium"> </div> <div class="text-sm"> </div></div> <div class="text-right"><div class="font-medium text-green-600 dark:text-green-400"> </div> <div class="text-sm text-gray-500 dark:text-gray-400"> </div></div></div></div>'),Bt=p("<!> Add Product",1),Ht=p('<div class="text-center py-16 border rounded-md bg-gray-50"><!> <p class="text-gray-500">No products added yet.</p> <p class="text-sm text-gray-400">Add products from the form on the right</p></div>'),Ut=p('<tr class="border-t hover:bg-gray-50"><td class="py-2 px-4"><div><span class="font-medium text-gray-600"> </span></div></td><td class="py-2 px-4 text-gray-600"><!></td><td class="py-2 px-4"><!></td><td class="py-2 px-4 text-gray-600"><!></td><td class="py-2 px-4 text-right"><!></td></tr>'),Vt=p("<!> Saving...",1),Gt=p("<!> Save Changes",1),Jt=p('<div class="border rounded-md overflow-hidden"><table class="w-full"><thead class="bg-gray-100 text-black"><tr><th class="py-2 px-4 text-left font-medium">Product</th><th class="py-2 px-4 text-left font-medium">Price</th><th class="py-2 px-4 text-left font-medium w-24">Reduction</th><th class="py-2 px-4 text-left font-medium">Final</th><th class="py-2 px-4 text-right font-medium w-16">Action</th></tr></thead><tbody></tbody></table></div> <div class="mt-4 flex justify-between items-center"><div></div> <!></div>',1),Kt=p('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"><div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg"><h3 class="text-lg font-medium mb-4">Confirm Deletion</h3> <p class="text-gray-600 dark:text-gray-300 mb-6">Are you sure you want to remove <span class="font-medium"> </span> from the MRP offer list?</p> <div class="flex justify-end space-x-2"><!> <!></div></div></div>'),Lt=p('<div class="flex w-full gap-6 mt-10"><div class="w-full lg:w-1/3 p-4 shadow rounded-md bg-white dark:bg-gray-800"><h3 class="text-lg font-medium mb-4">Add New Product MRP Offer</h3> <div class="mb-4"><!> <div class="relative"><!> <!></div></div> <div class="mb-4"><!> <!></div> <!> <!></div> <div class="w-2/3 pr-4 shadow bg-white p-5 rounded-lg"><div class="mb-4 flex justify-between"><h3 class="text-lg font-medium mb-2">Product MRP Offers</h3> <div class="flex items-center space-x-2"><!> <!></div></div> <!></div></div> <!>',1);function Wt(g,A){He(A,!1);const[v,C]=Ge(),u=()=>Je(fe,"$offerStore",v);let N=k(!1),$=k(!0),x=k(""),F=k([]),l=k({productId:"",productName:"",mrpReduction:"",price:0}),Y=k(!1),J=k(!1),W=1,K=k(!0),M=k(!1),O=k(null),w=k([]);Ke(async()=>{await $t("mrp"),await he(),await ae("")});async function ae(t,r=!1){if(!(r&&!e(K))){i(J,!0);try{const o=r?W:1,_=(await ge.get(`/product/all?q=${t}&page=${o}&limit=10`)).data.products||[];r?i(F,[...e(F),..._]):i(F,_),i(K,_.length===10),W=o+1}catch(o){console.error("Error searching products:",o),i(F,[])}finally{i(J,!1)}}}function Z(t){return/^[0-9]+$/.test(t)}function le(t){pe(t)}function pe(t){i(O,e(w)[t]),i(M,!0)}async function ee(){var t;if(e(O))try{const r=(t=u().data)==null?void 0:t._id;if(!r){m.error("No offer ID found. Please save the offer first.");return}const o=await ge.delete("/offer/remove-product",{params:{id:r,productId:e(O).productId}});o.data.status?(await he(),m.success("Product removed successfully")):m.error(o.data.message||"Failed to remove product")}catch(r){console.error("Error removing product:",r),m.error("An error occurred while removing the product")}finally{i(M,!1),i(O,null)}}function me(){i(M,!1),i(O,null)}function z(t){_e(l,e(l).productId=t._id),_e(l,e(l).productName=t.productName),_e(l,e(l).price=t.price),i(x,t.productName),i(Y,!1)}async function X(){var r;if(!e(l).productId||!Z(e(l).mrpReduction)){m.error("Please select a product and enter a valid MRP reduction value");return}if(e(w).findIndex(o=>o.productId===e(l).productId)>=0){m.error("This product is already in the MRP offer list"),i(l,{productId:"",productName:"",mrpReduction:"",price:0}),i(x,"");return}try{const o=(r=u().data)==null?void 0:r._id;if(!o){m.error("No offer ID found. Please save the offer first.");return}const f=await ge.post(`/offer/${o}/add-product`,{productId:e(l).productId,mrpReduction:parseInt(e(l).mrpReduction)});f.data.status?(await he(),m.success("Product added successfully")):m.error(f.data.message||"Failed to add product")}catch(o){console.error("Error adding product:",o),m.error("An error occurred while adding the product")}i(l,{productId:"",productName:"",mrpReduction:"",price:0}),i(x,"")}function be(t,r){Z(r)&&(i(w,[...e(w)]),_e(w,e(w)[t].mrpReduction=r))}function ye(t,r){return t-r}async function c(){var t;if(e(w).length===0){m.error("Please add at least one product with an MRP reduction");return}i(N,!0);try{const r=(t=u().data)==null?void 0:t._id;if(!r){m.error("No offer ID found. Please save the offer first.");return}const o=await ge.patch("/offer/update-products",{products:e(w).map(f=>({productId:f.productId,mrpReduction:parseInt(f.mrpReduction)}))},{params:{id:r}});if(o.data.status){xe("items",e(w).map(_=>({productId:_.productId,mrpReduction:parseInt(_.mrpReduction)}))),xe("isActive",e($));const f=await at();f&&f.status?(await he(),m.success("MRP offer saved successfully")):m.error("Failed to save MRP offer")}else m.error(o.data.message||"Failed to update MRP reductions")}catch(r){console.error("Error saving MRP offer:",r),m.error("An error occurred while saving")}finally{i(N,!1)}}function T(t){const r=t.target.value;i(x,r),W=1,i(K,!0),ae(r)}function V(){i(Y,!0)}function ot(){setTimeout(()=>{i(Y,!1)},200)}function st(t){const r=t.target;r.scrollTop+r.clientHeight>=r.scrollHeight-10&&ae(e(x),!0)}Fe(()=>u(),()=>{u().data&&u().data.items&&i(w,u().data.items.map(t=>{var o;const r=typeof t.productId=="object"&&t.productId?t.productId:{_id:t.productId,productName:"",price:0};return{productId:r._id||t.productId,productName:r.productName||"",price:r.price||0,mrpReduction:((o=t.mrpReduction)==null?void 0:o.toString())||"0",strikePrice:r.strikePrice||0}}))}),Fe(()=>u(),()=>{u().data&&i($,u().data.isActive!==void 0?u().data.isActive:!0)}),et(),Ve();var Oe=Lt(),we=H(Oe),Pe=s(we),Ie=d(s(Pe),2),Me=s(Ie);ve(Me,{class:"block text-sm font-medium mb-1",children:(t,r)=>{P();var o=U("Select Product");n(t,o)},$$slots:{default:!0}});var Te=d(Me,2),Ee=s(Te);$e(Ee,{id:"product-search",type:"text",placeholder:"Select or search for a product...",autocomplete:"off",oninput:T,onfocus:V,onblur:ot,class:"w-full",get value(){return e(x)},set value(t){i(x,t)},$$legacy:!0});var dt=d(Ee,2);{var it=t=>{var r=qt(),o=s(r);{var f=S=>{var E=Mt();n(S,E)},_=S=>{var E=Xe(),G=H(E);{var y=b=>{var h=Ct(),L=H(h);Ye(L,1,()=>e(F),Ze,(D,te)=>{var de=Et();de.__mousedown=[Tt,z,te];var re=s(de),Ne=s(re,!0);a(re);var ie=d(re,2),Se=s(ie);a(ie),a(de),oe(()=>{B(Ne,e(te).productName),B(Se,`₹${e(te).price??""}`)}),n(D,de)});var R=d(L,2);{var q=D=>{var te=jt();n(D,te)};j(R,D=>{e(K)&&!e(J)&&D(q)})}n(b,h)},I=b=>{var h=zt();n(b,h)};j(G,b=>{e(F).length>0?b(y):b(I,!1)},!0)}n(S,E)};j(o,S=>{e(J)?S(f):S(_,!1)})}a(r),tt("scroll",r,st),n(t,r)};j(dt,t=>{e(Y)&&t(it)})}a(Te),a(Ie);var ke=d(Ie,2),je=s(ke);ve(je,{class:"block text-sm font-medium mb-1",children:(t,r)=>{P();var o=U("MRP Reduction Value (₹)");n(t,o)},$$slots:{default:!0}});var nt=d(je,2);$e(nt,{type:"number",placeholder:"Enter MRP reduction value",class:"w-full",get value(){return e(l).mrpReduction},set value(t){_e(l,e(l).mrpReduction=t)},$$legacy:!0}),a(ke);var Ce=d(ke,2);{var ct=t=>{var r=Qt(),o=d(s(r),2),f=s(o),_=s(f),S=s(_,!0);a(_);var E=d(_,2),G=s(E);a(E),a(f);var y=d(f,2),I=s(y),b=s(I);a(I);var h=d(I,2),L=s(h);a(h),a(y),a(o),a(r),oe((R,q)=>{B(S,e(l).productName),B(G,`Original: ₹${R??""}`),B(b,`₹${q??""}`),B(L,`Reduction: ₹${e(l).mrpReduction??""}`)},[()=>e(l).price.toFixed(2),()=>ye(e(l).price,parseInt(e(l).mrpReduction)).toFixed(2)],De),n(t,r)};j(Ce,t=>{e(l).productId&&e(l).mrpReduction&&t(ct)})}var lt=d(Ce,2);ue(lt,{onclick:X,class:"w-full",children:(t,r)=>{var o=Bt(),f=H(o);se(f,{icon:"lucide:plus",class:"h-4 w-4 mr-2"}),P(),n(t,o)},$$slots:{default:!0}}),a(Pe);var ze=d(Pe,2),Ae=s(ze),qe=d(s(Ae),2),Qe=s(qe);ve(Qe,{for:"active-status",children:(t,r)=>{P();var o=U("Active");n(t,o)},$$slots:{default:!0}});var ut=d(Qe,2);rt(ut,{id:"active-status",get checked(){return e($)},onchange:t=>i($,t.currentTarget.checked)}),a(qe),a(Ae);var vt=d(Ae,2);{var ft=t=>{var r=Ht(),o=s(r);se(o,{icon:"lucide:package",class:"h-12 w-12 mx-auto text-gray-400 mb-2"}),P(4),a(r),n(t,r)},pt=t=>{var r=Jt(),o=H(r),f=s(o),_=d(s(f));Ye(_,5,()=>e(w),Ze,(G,y,I)=>{var b=Ut(),h=s(b),L=s(h),R=s(L),q=s(R,!0);a(R),a(L),a(h);var D=d(h),te=s(D);{var de=Q=>{var ne=U();oe(Re=>B(ne,`₹${Re??""}`),[()=>e(y).price.toFixed(2)],De),n(Q,ne)};j(te,Q=>{e(y).price&&Q(de)})}a(D);var re=d(D),Ne=s(re);$e(Ne,{get value(){return e(y).mrpReduction},class:"h-8",oninput:Q=>be(I,Q.currentTarget.value)}),a(re);var ie=d(re),Se=s(ie);{var _t=Q=>{var ne=U();oe(Re=>B(ne,`₹${Re??""}`),[()=>ye(e(y).price,parseInt(e(y).mrpReduction)).toFixed(2)],De),n(Q,ne)};j(Se,Q=>{e(y).price&&e(y).mrpReduction&&Q(_t)})}a(ie);var Be=d(ie),ht=s(Be);ue(ht,{type:"button",size:"icon",class:"h-8 w-8 bg-red-600 hover:bg-red-700",onclick:()=>le(I),children:(Q,ne)=>{se(Q,{icon:"lucide:trash-2",class:"h-4 w-4"})},$$slots:{default:!0}}),a(Be),a(b),oe(()=>B(q,e(y).productName||"Unknown Product")),n(G,b)}),a(_),a(f),a(o);var S=d(o,2),E=d(s(S),2);ue(E,{onclick:c,get disabled(){return e(N)},class:"px-6",children:(G,y)=>{var I=Xe(),b=H(I);{var h=R=>{var q=Vt(),D=H(q);se(D,{icon:"lucide:loader",class:"h-4 w-4 animate-spin mr-2"}),P(),n(R,q)},L=R=>{var q=Gt(),D=H(q);se(D,{icon:"lucide:save",class:"h-4 w-4 mr-2"}),P(),n(R,q)};j(b,R=>{e(N)?R(h):R(L,!1)})}n(G,I)},$$slots:{default:!0}}),a(S),n(t,r)};j(vt,t=>{e(w).length===0?t(ft):t(pt,!1)})}a(ze),a(we);var mt=d(we,2);{var gt=t=>{var r=Kt(),o=s(r),f=d(s(o),2),_=d(s(f)),S=s(_,!0);a(_),P(),a(f);var E=d(f,2),G=s(E);ue(G,{variant:"outline",onclick:me,children:(I,b)=>{P();var h=U("Cancel");n(I,h)},$$slots:{default:!0}});var y=d(G,2);ue(y,{class:"bg-red-600 hover:bg-red-700",onclick:ee,children:(I,b)=>{P();var h=U("Confirm");n(I,h)},$$slots:{default:!0}}),a(E),a(o),a(r),oe(()=>B(S,e(O).productName)),n(t,r)};j(mt,t=>{e(M)&&e(O)&&t(gt)})}n(g,Oe),Ue(),C()}yt(["mousedown"]);var Xt=p('<span class="text-xs text-red-500">Discount must be a valid number</span>'),Yt=p('<span class="text-xs text-red-500">Number of attempts must be a valid number</span>'),Zt=p('<div class="max-w-[50%] text-maintext mt-10 pl-[10%]"><form class="grid gap-4 py-4"><div><!> <!> <!></div> <div><!> <!> <!></div> <div class="flex items-center space-x-2"><!> <!></div> <!></form></div>');function er(g,A){He(A,!1);const[v,C]=Ge(),u=()=>Je(fe,"$offerStore",v);let N=k(!1),$=k(""),x=k(""),F=k(!0);Ke(()=>{he()});function l(c){return/^[0-9]+$/.test(c)}async function Y(){if(!l(e($))){m.error("Discount must be a valid number");return}if(!l(e(x))){m.error("Number of attempts must be a valid number");return}xe("percentage",parseInt(e($))),xe("noOfAttempts",parseInt(e(x))),xe("isActive",e(F)),i(N,!0);try{const c=await at();c&&c.status?m.success("Negotiate offer saved successfully"):m.error("Failed to save negotiate offer")}catch(c){console.error("Error saving negotiate offer:",c),m.error("An error occurred while saving")}finally{i(N,!1)}}Fe(()=>u(),()=>{var c,T;u().data&&(i($,((c=u().data.percentage)==null?void 0:c.toString())||""),i(x,((T=u().data.noOfAttempts)==null?void 0:T.toString())||""),i(F,u().data.isActive!==void 0?u().data.isActive:!0))}),et(),Ve();var J=Zt(),W=s(J),K=s(W),M=s(K);ve(M,{for:"discount",children:(c,T)=>{P();var V=U("Initial Discount (%)");n(c,V)},$$slots:{default:!0}});var O=d(M,2);$e(O,{id:"discount",class:"pr-10 mt-1",placeholder:"Ex: 10",get value(){return e($)},set value(c){i($,c)},$$legacy:!0});var w=d(O,2);{var ae=c=>{var T=Xt();n(c,T)};j(w,c=>{e($)&&!l(e($))&&c(ae)})}a(K);var Z=d(K,2),le=s(Z);ve(le,{for:"attempts",children:(c,T)=>{P();var V=U("Number of Negotiation Attempts");n(c,V)},$$slots:{default:!0}});var pe=d(le,2);$e(pe,{id:"attempts",class:"pr-10 mt-1",placeholder:"Ex: 3",get value(){return e(x)},set value(c){i(x,c)},$$legacy:!0});var ee=d(pe,2);{var me=c=>{var T=Yt();n(c,T)};j(ee,c=>{e(x)&&!l(e(x))&&c(me)})}a(Z);var z=d(Z,2),X=s(z);rt(X,{id:"active-status",get checked(){return e(F)},onCheckedChange:c=>i(F,c)});var be=d(X,2);ve(be,{for:"active-status",children:(c,T)=>{P();var V=U("Active");n(c,V)},$$slots:{default:!0}}),a(z);var ye=d(z,2);ue(ye,{class:"w-[100px]",type:"submit",get disabled(){return e(N)},children:(c,T)=>{P();var V=U();oe(()=>B(V,e(N)?"Saving...":"Save")),n(c,V)},$$slots:{default:!0}}),a(W),a(J),tt("submit",W,bt(Y)),n(g,J),Ue(),C()}var tr=p('<div class="p-2 text-gray-500">Searching...</div>'),rr=(g,A,v)=>A({_id:e(v)._id,productName:e(v).productName,price:e(v).price,strikePrice:e(v).strikePrice}),ar=p('<div class="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer flex justify-between items-center"><span class="text-black dark:text-white"> </span> <span class="text-black dark:text-white"> </span></div>'),or=p('<div class="p-2 text-gray-500">Loading more...</div>'),sr=p("<!> <!>",1),dr=p('<div class="p-2 text-gray-500">No products found</div>'),ir=p('<div class="dropdown-container absolute z-20 w-full bg-white dark:bg-gray-900 mt-1 border border-gray-200 dark:border-gray-700 rounded shadow-lg max-h-48 overflow-y-auto"><!></div>'),nr=p('<div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md mb-4"><div class="text-sm text-gray-500 dark:text-gray-400">Preview</div> <div class="flex justify-between items-center mt-1"><div><div class="font-medium"> </div> <div class="text-sm"> </div></div> <div class="text-right"><div class="font-medium text-green-600 dark:text-green-400"> </div> <div class="text-sm text-gray-500 dark:text-gray-400"> </div></div></div></div>'),cr=p("<!> Add Product",1),lr=p('<div class="text-center py-16 border rounded-md bg-gray-50"><!> <p class="text-gray-500">No products added yet.</p> <p class="text-sm text-gray-400">Add products from the form on the right</p></div>'),ur=p('<tr class="border-t hover:bg-gray-50"><td class="py-2 px-4"><div><span class="font-medium text-gray-600"> </span></div></td><td class="py-2 px-4 text-gray-600"><!></td><td class="py-2 px-4"><!></td><td class="py-2 px-4 text-gray-600"><!></td><td class="py-2 px-4 text-right"><!></td></tr>'),vr=p("<!> Saving...",1),fr=p("<!> Save Changes",1),pr=p('<div class="border rounded-md overflow-hidden"><table class="w-full"><thead class="bg-gray-100 text-black"><tr><th class="py-2 px-4 text-left font-medium">Product</th><th class="py-2 px-4 text-left font-medium">Price</th><th class="py-2 px-4 text-left font-medium w-24">Discount</th><th class="py-2 px-4 text-left font-medium">Final</th><th class="py-2 px-4 text-right font-medium w-16">Action</th></tr></thead><tbody></tbody></table></div> <div class="mt-4 flex justify-between items-center"><div></div> <!></div>',1),mr=p('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"><div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg"><h3 class="text-lg font-medium mb-4">Confirm Deletion</h3> <p class="text-gray-600 dark:text-gray-300 mb-6">Are you sure you want to remove <span class="font-medium"> </span> from the discount list?</p> <div class="flex justify-end space-x-2"><!> <!></div></div></div>'),gr=p('<div class="flex w-full gap-6 mt-10"><div class="w-full lg:w-1/3 p-4 shadow rounded-md bg-white dark:bg-gray-800"><h3 class="text-lg font-medium mb-4">Add New Product Discount</h3> <div class="mb-4"><!> <div class="relative"><!> <!></div></div> <div class="mb-4"><!> <!></div> <!> <!></div> <div class="w-2/3 pr-4 shadow bg-white p-5 rounded-lg"><div class="mb-4 flex justify-between"><h3 class="text-lg font-medium mb-2">Product Discounts</h3> <div class="flex items-center space-x-2"><!> <!></div></div> <!></div></div> <!>',1);function _r(g,A){He(A,!1);const[v,C]=Ge(),u=()=>Je(fe,"$offerStore",v);let N=k(!1),$=k(!0),x=k(""),F=k([]),l=k({productId:"",productName:"",discount:"",price:0}),Y=k(!1),J=k(!1),W=1,K=k(!0),M=k(!1),O=k(null),w=k([]);Ke(async()=>{await he(),await ae("")});async function ae(t,r=!1){if(!(r&&!e(K))){i(J,!0);try{const o=r?W:1,_=(await ge.get(`/product/all?q=${t}&page=${o}&limit=10`)).data.products||[];r?i(F,[...e(F),..._]):i(F,_),i(K,_.length===10),W=o+1}catch(o){console.error("Error searching products:",o),i(F,[])}finally{i(J,!1)}}}function Z(t){return/^[0-9]+$/.test(t)}function le(t){pe(t)}function pe(t){i(O,e(w)[t]),i(M,!0)}async function ee(){var t;if(e(O))try{const r=(t=u().data)==null?void 0:t._id;if(!r){m.error("No offer ID found. Please save the offer first.");return}const o=await ge.delete("/offer/remove-product",{params:{id:r,productId:e(O).productId}});o.data.status?(await he(),m.success("Product removed successfully")):m.error(o.data.message||"Failed to remove product")}catch(r){console.error("Error removing product:",r),m.error("An error occurred while removing the product")}finally{i(M,!1),i(O,null)}}function me(){i(M,!1),i(O,null)}function z(t){_e(l,e(l).productId=t._id),_e(l,e(l).productName=t.productName),_e(l,e(l).price=t.price),i(x,t.productName),i(Y,!1)}async function X(){var r;if(!e(l).productId||!Z(e(l).discount)){m.error("Please select a product and enter a valid discount percentage");return}if(e(w).findIndex(o=>o.productId===e(l).productId)>=0){m.error("This product is already in the discount list"),i(l,{productId:"",productName:"",discount:"",price:0}),i(x,"");return}try{const o=(r=u().data)==null?void 0:r._id;if(!o){m.error("No offer ID found. Please save the offer first.");return}const f=await ge.post(`/offer/${o}/add-product`,{productId:e(l).productId,discount:parseInt(e(l).discount)});f.data.status?(await he(),m.success("Product added successfully")):m.error(f.data.message||"Failed to add product")}catch(o){console.error("Error adding product:",o),m.error("An error occurred while adding the product")}i(l,{productId:"",productName:"",discount:"",price:0}),i(x,"")}function be(t,r){Z(r)&&(i(w,[...e(w)]),_e(w,e(w)[t].discount=r))}function ye(t,r){return t-t*r/100}async function c(){var t;if(e(w).length===0){m.error("Please add at least one product with discount");return}i(N,!0);try{const r=(t=u().data)==null?void 0:t._id;if(!r){m.error("No offer ID found. Please save the offer first.");return}const o=await ge.patch("/offer/update-products",{products:e(w).map(f=>({productId:f.productId,discount:parseInt(f.discount)}))},{params:{id:r}});if(o.data.status){xe("items",e(w).map(_=>({productId:_.productId,discount:parseInt(_.discount)}))),xe("isActive",e($));const f=await at();f&&f.status?(await he(),m.success("Discount offer saved successfully")):m.error("Failed to save discount offer")}else m.error(o.data.message||"Failed to update discounts")}catch(r){console.error("Error saving discount offer:",r),m.error("An error occurred while saving")}finally{i(N,!1)}}function T(t){const r=t.target.value;i(x,r),W=1,i(K,!0),ae(r)}function V(){i(Y,!0)}function ot(){setTimeout(()=>{i(Y,!1)},200)}function st(t){const r=t.target;r.scrollTop+r.clientHeight>=r.scrollHeight-10&&ae(e(x),!0)}Fe(()=>u(),()=>{u().data&&u().data.items&&i(w,u().data.items.map(t=>{const r=typeof t.productId=="object"&&t.productId?t.productId:{_id:t.productId,productName:"",price:0};return{productId:r._id||t.productId,productName:r.productName||"",price:r.price||0,discount:t.discount.toString(),strikePrice:r.strikePrice||0}}))}),Fe(()=>u(),()=>{u().data&&i($,u().data.isActive!==void 0?u().data.isActive:!0)}),et(),Ve();var Oe=gr(),we=H(Oe),Pe=s(we),Ie=d(s(Pe),2),Me=s(Ie);ve(Me,{class:"block text-sm font-medium mb-1",children:(t,r)=>{P();var o=U("Select Product");n(t,o)},$$slots:{default:!0}});var Te=d(Me,2),Ee=s(Te);$e(Ee,{id:"product-search",type:"text",placeholder:"Select or search for a product...",autocomplete:"off",oninput:T,onfocus:V,onblur:ot,class:"w-full",get value(){return e(x)},set value(t){i(x,t)},$$legacy:!0});var dt=d(Ee,2);{var it=t=>{var r=ir(),o=s(r);{var f=S=>{var E=tr();n(S,E)},_=S=>{var E=Xe(),G=H(E);{var y=b=>{var h=sr(),L=H(h);Ye(L,1,()=>e(F),Ze,(D,te)=>{var de=ar();de.__mousedown=[rr,z,te];var re=s(de),Ne=s(re,!0);a(re);var ie=d(re,2),Se=s(ie);a(ie),a(de),oe(()=>{B(Ne,e(te).productName),B(Se,`₹${e(te).price??""}`)}),n(D,de)});var R=d(L,2);{var q=D=>{var te=or();n(D,te)};j(R,D=>{e(K)&&!e(J)&&D(q)})}n(b,h)},I=b=>{var h=dr();n(b,h)};j(G,b=>{e(F).length>0?b(y):b(I,!1)},!0)}n(S,E)};j(o,S=>{e(J)?S(f):S(_,!1)})}a(r),tt("scroll",r,st),n(t,r)};j(dt,t=>{e(Y)&&t(it)})}a(Te),a(Ie);var ke=d(Ie,2),je=s(ke);ve(je,{class:"block text-sm font-medium mb-1",children:(t,r)=>{P();var o=U("Discount Percentage (%)");n(t,o)},$$slots:{default:!0}});var nt=d(je,2);$e(nt,{type:"number",placeholder:"Enter discount percentage",class:"w-full",get value(){return e(l).discount},set value(t){_e(l,e(l).discount=t)},$$legacy:!0}),a(ke);var Ce=d(ke,2);{var ct=t=>{var r=nr(),o=d(s(r),2),f=s(o),_=s(f),S=s(_,!0);a(_);var E=d(_,2),G=s(E);a(E),a(f);var y=d(f,2),I=s(y),b=s(I);a(I);var h=d(I,2),L=s(h);a(h),a(y),a(o),a(r),oe((R,q)=>{B(S,e(l).productName),B(G,`Original: ₹${R??""}`),B(b,`₹${q??""}`),B(L,`Discount: ${e(l).discount??""}%`)},[()=>e(l).price.toFixed(2),()=>ye(e(l).price,parseInt(e(l).discount)).toFixed(2)],De),n(t,r)};j(Ce,t=>{e(l).productId&&e(l).discount&&t(ct)})}var lt=d(Ce,2);ue(lt,{onclick:X,class:"w-full",children:(t,r)=>{var o=cr(),f=H(o);se(f,{icon:"lucide:plus",class:"h-4 w-4 mr-2"}),P(),n(t,o)},$$slots:{default:!0}}),a(Pe);var ze=d(Pe,2),Ae=s(ze),qe=d(s(Ae),2),Qe=s(qe);ve(Qe,{for:"active-status",children:(t,r)=>{P();var o=U("Active");n(t,o)},$$slots:{default:!0}});var ut=d(Qe,2);rt(ut,{id:"active-status",get checked(){return e($)},onchange:t=>i($,t.currentTarget.checked)}),a(qe),a(Ae);var vt=d(Ae,2);{var ft=t=>{var r=lr(),o=s(r);se(o,{icon:"lucide:package",class:"h-12 w-12 mx-auto text-gray-400 mb-2"}),P(4),a(r),n(t,r)},pt=t=>{var r=pr(),o=H(r),f=s(o),_=d(s(f));Ye(_,5,()=>e(w),Ze,(G,y,I)=>{var b=ur(),h=s(b),L=s(h),R=s(L),q=s(R,!0);a(R),a(L),a(h);var D=d(h),te=s(D);{var de=Q=>{var ne=U();oe(Re=>B(ne,`₹${Re??""}`),[()=>e(y).price.toFixed(2)],De),n(Q,ne)};j(te,Q=>{e(y).price&&Q(de)})}a(D);var re=d(D),Ne=s(re);$e(Ne,{get value(){return e(y).discount},class:"h-8",oninput:Q=>be(I,Q.currentTarget.value)}),a(re);var ie=d(re),Se=s(ie);{var _t=Q=>{var ne=U();oe(Re=>B(ne,`₹${Re??""}`),[()=>ye(e(y).price,parseInt(e(y).discount)).toFixed(2)],De),n(Q,ne)};j(Se,Q=>{e(y).price&&e(y).discount&&Q(_t)})}a(ie);var Be=d(ie),ht=s(Be);ue(ht,{type:"button",size:"icon",class:"h-8 w-8 bg-red-600 hover:bg-red-700",onclick:()=>le(I),children:(Q,ne)=>{se(Q,{icon:"lucide:trash-2",class:"h-4 w-4"})},$$slots:{default:!0}}),a(Be),a(b),oe(()=>B(q,e(y).productName||"Unknown Product")),n(G,b)}),a(_),a(f),a(o);var S=d(o,2),E=d(s(S),2);ue(E,{onclick:c,get disabled(){return e(N)},class:"px-6",children:(G,y)=>{var I=Xe(),b=H(I);{var h=R=>{var q=vr(),D=H(q);se(D,{icon:"lucide:loader",class:"h-4 w-4 animate-spin mr-2"}),P(),n(R,q)},L=R=>{var q=fr(),D=H(q);se(D,{icon:"lucide:save",class:"h-4 w-4 mr-2"}),P(),n(R,q)};j(b,R=>{e(N)?R(h):R(L,!1)})}n(G,I)},$$slots:{default:!0}}),a(S),n(t,r)};j(vt,t=>{e(w).length===0?t(ft):t(pt,!1)})}a(ze),a(we);var mt=d(we,2);{var gt=t=>{var r=mr(),o=s(r),f=d(s(o),2),_=d(s(f)),S=s(_,!0);a(_),P(),a(f);var E=d(f,2),G=s(E);ue(G,{variant:"outline",onclick:me,children:(I,b)=>{P();var h=U("Cancel");n(I,h)},$$slots:{default:!0}});var y=d(G,2);ue(y,{class:"bg-red-600 hover:bg-red-700",onclick:ee,children:(I,b)=>{P();var h=U("Confirm");n(I,h)},$$slots:{default:!0}}),a(E),a(o),a(r),oe(()=>B(S,e(O).productName)),n(t,r)};j(mt,t=>{e(M)&&e(O)&&t(gt)})}n(g,Oe),Ue(),C()}yt(["mousedown"]);var hr=p('<meta name="description" content="Offer management dashboard">'),$r=p('<!> <span class="ml-2">Flat % Discount</span>',1),xr=p('<!> <span class="ml-2">MRP Discount</span>',1),yr=p('<!> <span class="ml-2">Negotiable</span>',1),br=p('<!> <span class="ml-2">On MRP Purchase</span>',1),wr=p("<!> <!> <!> <!>",1),Pr=p("<!> <!> <!> <!> <!>",1);function Jr(g,A){He(A,!1);const[v,C]=Ge(),u=()=>Je(fe,"$offerStore",v);Ke(()=>{u().mode&&$t(u().mode)});function N($){$t($)}Ve(),kt($=>{var x=hr();It.title="Dashboard | Offers",n($,x)}),At(g,{class:"w-full p-4",get value(){return u().mode},onValueChange:N,children:($,x)=>{var F=Pr(),l=H(F);Nt(l,{children:(M,O)=>{var w=wr(),ae=H(w);Le(ae,{value:"flat",class:"flex items-center",children:(ee,me)=>{var z=$r(),X=H(z);se(X,{class:"w-4 h-4",icon:"hugeicons:discount"}),P(2),n(ee,z)},$$slots:{default:!0}});var Z=d(ae,2);Le(Z,{value:"discount",class:"flex items-center",children:(ee,me)=>{var z=xr(),X=H(z);se(X,{class:"w-4 h-4",icon:"icon-park-outline:tag-one"}),P(2),n(ee,z)},$$slots:{default:!0}});var le=d(Z,2);Le(le,{value:"negotiate",class:"flex items-center",children:(ee,me)=>{var z=yr(),X=H(z);se(X,{class:"w-4 h-4",icon:"tdesign:user-talk-1"}),P(2),n(ee,z)},$$slots:{default:!0}});var pe=d(le,2);Le(pe,{value:"mrp",class:"flex items-center",children:(ee,me)=>{var z=br(),X=H(z);se(X,{class:"w-4 h-4",icon:"material-symbols:currency-rupee-circle-outline"}),P(2),n(ee,z)},$$slots:{default:!0}}),n(M,w)},$$slots:{default:!0}});var Y=d(l,2);We(Y,{value:"flat",children:(M,O)=>{Ot(M,{})},$$slots:{default:!0}});var J=d(Y,2);We(J,{value:"discount",children:(M,O)=>{_r(M,{})},$$slots:{default:!0}});var W=d(J,2);We(W,{value:"mrp",children:(M,O)=>{Wt(M,{})},$$slots:{default:!0}});var K=d(W,2);We(K,{value:"negotiate",children:(M,O)=>{er(M,{})},$$slots:{default:!0}}),n($,F)},$$slots:{default:!0}}),Ue(),C()}export{Jr as component};
